@(wParams: java.util.Map[String, Array[String]])
@import models.WeblapModell
<html>
<head>
<meta charset="UTF-8">
<title>Weblap ajaxszal</title>
<script type="text/javascript">
/*
window.onbeforeunload = (function() { "alert('onbeforeunload')"; })
window.onunload = (function() { "alert('onunload')"; })
window.onpagehide = (function() { "alert('onpagehide')"; })
nem működnek */
</script>

<style>
.feldobos
{
	position: relative;
	display: inline-block;
}
.feldobosbavalo
{
	display: none;
	/*height: 200px;*/
	overflow-y: auto;
}
.feldobos:hover .feldobosbavalo
{
	display: block;
	position: absolute;
	/*opacity: 1; ettől ugyanaz; 0-tól meg egyáltalán nem látszik*/
	background-color: White; /*ez kell, hogy letakarja az alatta levőt - de a feldobos-ban a gomb ezt takarja le!*/
	z-index: 1; /*ez megoldja a gomb takarását*/
	width: 1000px;
}

div.korlatozottmagassag1000
{
	width: 80%;	/*csak nyolcvan, hogy lehessen mellette letekerni*/
	margin: auto; /*méghozzá kétoldalt*/
	max-height: 1000px;
	overflow-y: auto;
}

.alacsonygomb
{
	height: 16px;
	font-size: 0.5em;
}

/* füles div, http://qnimate.com/tabbed-area-using-html-and-css-only/  */
.tabs
{
	position: relative;
	clear: both;
}

.tabs .tab
{
	float: left;
}

.tabs .tab .content
{
	position: absolute;
	background-color: white;
	left: 0px;
	width: 100%;
	border: 1px #000 solid;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
	align-items: flex-start;
}

.checkboxtab
{
	display: none;
}

.tab label
{
	margin-right: 10px;
}

.checkboxtab:checked ~ label
{
	color: #ab70ff;
	border: 1px #000 solid;
}

.checkboxtab:checked ~ .content
{
	z-index: 1;
}

#statusz
{
	background-color: cornsilk;
}

#uzen
{
	background-color: aliceblue;
}
</style>
</head>
<body>
 <!-- 
	onload="alert('load');"
	onpageshow="alert('pageshow');"
	onpagehide="alert('pagehide');"
	onunload="alert('unload');"
  -->
 <!-- 
<div id=ajaxform>ajaxform helye</div>  helyett .ajaxForm(wParams) (nem ajaxszal)
  -->
 <!--<a href="weblapajax">alapra</a>-->
@Html(WeblapModell.ajaxAlapraForm(wParams))
<div id=ajaxstatusz style="color: blue;"></div>
<div id=statusz></div>
<div id=uzen></div>
<button onclick="statuszgomb()">Státusz</button>
@Html(WeblapModell.ajaxForm(wParams))
<script type="text/javascript">

var ajaxobj = new XMLHttpRequest();

/* ajax onreadystatechange-nek @*
 * jó esetben a válasz elején egy id van, hova kell beszúrni
 * ajaxobj-'t használja (lehetne paraméter)
 * @param muvnev:String műveletnév, csak állapotkijelzéshez
 * @param tovabbi:function ha kész, további lépés
 * @param tovabbiPar az előbbi paramétere(i) *@
 */
function ajaxvalasz(muvnev, tovabbi, ...tovabbiPar)
{
	console.log(`${muvnev} folyamatban, readystate=${ajaxobj.readyState}, státusz=${ajaxobj.status} ${ajaxobj.statusText}`);
	if (ajaxobj.readyState == 4)
	{
		var hova, mit;
		var kette = ajaxobj.responseText.split('¤'); //az'ttem, hogy csak ketté lesz, a for csak utána jutott eszembe
		if (kette.length==1)  //ha nem 200, biztos ez lesz a helyzet
			kette.unshift(muvnev=="inic" ? 'ajaxinic' : 'statusz');
		for(var i=0;i<kette.length;i+=2)
		{
			hova = kette[i];
			mit = kette[i+1];
			/* */ console.log(`hova=${hova}, mit=${mit}`);
			document.getElementById(hova).innerHTML = mit;
		}
		ajaxstatuszdiv.innerHTML = muvnev + " kész, státusz=" + ajaxobj.statusText;
		if (ajaxobj.status == 200) if (tovabbi) tovabbi.apply(this, tovabbiPar);
	}
}
// innentől bárhány helyre bárhány kóddarabot oda tudok ajaxolni egy hívásból

function inicgomb()
{
	console.log('Inic meg van nyomva');
	var formelemek = document.forms.inicform.elements;
	//**/ console.log(  'weblapajaxinic?url=' + formelemek.url.value + '&s=' + formelemek.s.value);
	inicajaxhivas('weblapajaxinic?url=' + formelemek.url.value + '&s=' + formelemek.s.value);
}

function inicajaxhivas(cim)
{
	/* */ console.log("inicajaxhivas cim="+cim)
	ajaxobj.open('GET', cim);
	ajaxobj.onreadystatechange = function(){ajaxvalasz('inic', feldolggomb, '');} //közvetlenül az ajaxvalasz-t csak () nélkül lehetne odaadni neki, vagyis par. nélkül
	ajaxobj.send();
	ajaxstatuszdiv.innerHTML = "inic folyamatban...";
}

function feldolggomb(pluszpar)
{
	feldolgajaxhivas(document.getElementById('idoLong').innerHTML, pluszpar);
}

function feldolgajaxhivas(pill, pluszpar)
{
	console.log(`feldolgajaxhivas($pill, $pluszpar) ` + 'weblapajaxfeldolg?pill=' + pill + pluszpar);
	ajaxobj.open('GET', 'weblapajaxfeldolg?pill=' + pill + pluszpar);
	ajaxobj.onreadystatechange = function(){ajaxvalasz('feldolg', statuszgomb);}
/*
	{
		console.log("feldolg folyamatban, readystate=" + ajaxobj.readyState + ", státusz=" + ajaxobj.status + " " + ajaxobj.statusText);
		if (ajaxobj.readyState == 4)
			//if (ajaxobj.status == 200)
			{
				feldolgdiv.innerHTML = ajaxobj.responseText;
				ajaxstatuszdiv.innerHTML = "feldolg kész, státusz=" + ajaxobj.status;
				//ha a képnek ugyanaz a címe, de megváltozott: (de ezt lehet, hogy a hívóból kéne intézni)
				//var kepElem = document.querySelector("#ajaxfeldolg img");  //attribútumra csak getter meg setter van, azért ilyen bonyolult
				//if (kepElem) kepElem.setAttribute("src", kepElem.getAttribute("src") + "#" + document.getElementById('idoLong').innerHTML)
			}
	};
*/
	ajaxobj.send();
	ajaxstatuszdiv.innerHTML = "feldolg folyamatban...";
}

function statuszgomb()
{
  ajaxobj.open('GET', 'weblapajaxfeldolg?pill=0&muvelet=statusz');
  ajaxobj.onreadystatechange = function()
  {
    if (ajaxobj.readyState == 4)
    	statuszdiv.innerHTML = ajaxobj.responseText;
  }
  ajaxobj.send();
  statuszdiv.innerHTML = "státusz... mindjárt";
}
</script>
<div id=ajaxinic>ajaxinic kimenet helye</div>
<button type="button" onclick="inicgomb()">Inic</button>
<button type="button" onclick="console.log('Feldolg. meg van nyomva'); feldolggomb('')">Feldolgozás</button>
<button type="button" onclick="feldolggomb('&muvelet=csuk')">Csuk</button>
<div id=ajaxfeldolg>ajaxfeldolg helye</div>
<script>
var ajaxstatuszdiv = document.getElementById("ajaxstatusz");
var statuszdiv = document.getElementById("statusz");
var inicdiv = document.getElementById("ajaxinic");
var feldolgdiv = document.getElementById("ajaxfeldolg");
</script>

<!-- @*   twirl-ül is ki kell kommentelni!! (vagy csak úgy)
@Html(WeblapModell.feldolg)
*@ -->
 
</body>
</html>
